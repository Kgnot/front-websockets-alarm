<section class="alarm-section">
  <div>
    <h1> Estado: {{ connectionStatus() }}</h1>
  </div>
  <div>
    <button
      (click)="connect()"
      [disabled]="isConnected()"
    >
      Conectar
    </button>
    <button
      (click)="disconnect()"
      [disabled]="!isConnected()"
    >
      Desconectar
    </button>
  </div>

  <div class="notifications">
    @for (notification of notifications(); track notification.id) {
      <div class="notification-card">
        <div class="notification-content" (click)="openModal(notification)">
          <div class="notification-header">
            <span class="notification-user">{{ notification.user?.name || 'Nombre usuario' }}</span>
            <span class="notification-time">
              {{ (notification.alarmUserDevice?.location?.timestamp | date:'shortTime') ?? 'Hora desconocida' }}
            </span>
          </div>

          <div class="notification-body">
            <div class="notification-title">Alarma</div>
            <div class="notification-location">
              {{ notification.user?.address || 'Dirección desconocida' }}
            </div>
          </div>
        </div>

        <div class="notification-action">
          <span class="material-icons">volume_up</span>
        </div>
      </div>
    }
  </div>

  <!-- Modal con dialog -->
  <dialog #alarmModal>
    <h2>Detalles de la alarma</h2>
    <p><strong>ID:</strong> {{ selected?.id }}</p>
    <p><strong>Usuario:</strong> {{ selected?.user?.name }}</p>
    <p><strong>Email:</strong> {{ selected?.user?.email }}</p>
    <p><strong>Teléfono:</strong> {{ selected?.user?.phone }}</p>
    <p><strong>Dispositivo:</strong> {{ selected?.alarmUserDevice?.device }}</p>
    <p><strong>Ubicación:</strong>
      {{ selected?.alarmUserDevice?.location?.lat }},
      {{ selected?.alarmUserDevice?.location?.lng }}
    </p>
    <p><strong>Verificación:</strong>
      {{ selected?.user?.isVerified ? 'Verificado' : 'No verificado' }}
    </p>

    <menu>
      <button (click)="closeModal()">Cerrar</button>
    </menu>
  </dialog>
</section>
